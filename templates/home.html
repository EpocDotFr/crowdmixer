{% extends 'layout.html' %}

{% block content %}
    <form method="get" action="{{ url_for('home') }}" class="mas">
        <input type="search" name="q" placeholder="{{ _('Type a title, an artist or an album') }}" required autocomplete="off" value="{{ request.args.q }}">
    </form>

    {% if now_playing %}
        <h2 class="pas man bggrey btg"><i class="fa fa-play-circle"></i> {{ _('Now playing') }}</h2>

        <div class="song btg pas">
            <div>{% if not now_playing.title and not now_playing.artist %}{{ now_playing.filename }}{% else %}{{ now_playing.title }}{% endif %}</div>
            <small class="txtmuted">{% if not now_playing.artist %}{{ _('Unknown artist') }}{% else %}{{ now_playing.artist }}{% endif %}</small>
        </div>
    {% endif %}

    <h2 class="pas man bggrey btg">{% if not request.args.q %}<i class="fa fa-book"></i> {{ _('Available songs') }}{% else %}<i class="fa fa-search"></i> {{ _('Search results') }}{% endif %} ({{ songs|length }})</h2>

    {% if songs %}
        <div class="songs">
            {% for song in songs %}
                <div class="song btg pas">
                    <div>{{ song.title }}</div>
                    <small class="txtmuted">{% if not song.artist %}{{ _('Unknown artist') }}{% else %}{{ song.artist }}{% endif %}</small>
                    <div class="txtright">
                        {% if song.last_queued_at and (arrow.now().timestamp - song.last_queued_at.timestamp) <= config['BLOCK_TIME'] %}
                            {% set btn_class = 'is-disabled' %}
                            {% set btn_label = _('Queued %(last_queued_at)s', last_queued_at=song.last_queued_at.humanize(locale=g.CURRENT_LOCALE)) %}
                        {% else %}
                            {% if config['MODE'] == 'Vote' %}
                                {{ song.votes }}/{{ config['VOTES_THRESHOLD'] }} {{ _('votes') }}
                            {% endif %}

                            {% if already_submitted_time and (arrow.now().timestamp - already_submitted_time.timestamp) <= config['REQUEST_LIMIT'] %}
                                {% set btn_class = 'is-disabled' %}

                                {% if config['MODE'] == 'Vote' %}
                                    {% set btn_label = _('Vote') %}
                                {% else %}
                                    {% set btn_label = _('Queue') %}
                                {% endif %}
                            {% else %}
                                {% set btn_class = 'primary' %}

                                {% if config['MODE'] == 'Vote' %}
                                    {% set btn_label = '<i class="fa fa-chevron-right"></i> '|safe + _('Vote') %}
                                {% else %}
                                    {% set btn_label = '<i class="fa fa-chevron-right"></i> '|safe + _('Queue') %}
                                {% endif %}
                            {% endif %}
                        {% endif %}

                        <a href="{{ url_for('submit', song_id=song.id) }}" class="btn {{ btn_class }}" {% if btn_class == 'is-disabled' %}onClick="return false;"{% endif %}>{{ btn_label }}</a>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <p class="alert error pas mas">{{ _('No song to display.') }}</p>
    {% endif %}
{% endblock %}